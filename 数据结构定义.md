# DevOps Platform 数据结构定义

## 概述

本文档详细定义了 DevOps Platform 系统中所有 API 接口的返回值格式和数据结构，供前端开发人员参考使用。

## 1. 通用响应结构

### 1.1 基础响应结构 (Response)

```typescript
interface Response<T = any> {
  code: number;           // 状态码
  data: T;               // 响应数据
  message: string;       // 响应消息
}
```

### 1.2 分页响应结构 (PageResponse)

```typescript
interface PageResponse<T> {
  code: number;
  data: {
    list: T[];           // 数据列表
    total: number;       // 总记录数
    page: number;        // 当前页码
    size: number;        // 每页大小
  };
  message: string;
}
```

### 1.3 错误响应结构 (ErrorResponse)

```typescript
interface ErrorResponse {
  code: number;          // 错误码
  error: string;         // 错误类型
  message: string;       // 错误消息
  request_id: string;    // 请求ID
}
```

## 2. 认证模块数据结构

### 2.1 登录请求 (LoginRequest)

```typescript
interface LoginRequest {
  username: string;      // 用户名
  password: string;      // 密码
}
```

### 2.2 登录响应 (LoginResponse)

```typescript
interface LoginResponse {
  token: string;         // JWT访问令牌
  expire_at: string;     // 过期时间 (ISO 8601格式)
}
```

### 2.3 用户注册请求 (RegisterRequest)

```typescript
interface RegisterRequest {
  username: string;      // 用户名
  password: string;      // 密码
  name: string;          // 真实姓名
  mobile?: string;       // 手机号
  email?: string;        // 邮箱
  avatar?: string;       // 头像URL
  dept_id?: number;      // 部门ID
  role?: number;         // 角色ID
}
```

### 2.4 修改密码请求 (ChangePasswordRequest)

```typescript
interface ChangePasswordRequest {
  old_password: string;  // 旧密码
  new_password: string;  // 新密码
  confirm_password: string; // 确认密码
}
```

### 2.5 用户信息 (UserInfo)

```typescript
interface UserInfo {
  id: number;            // 用户ID
  username: string;      // 用户名
  nickname: string;      // 昵称
  email: string;         // 邮箱
  phone: string;         // 手机号
  avatar: string;        // 头像URL
  dept_id: number;       // 部门ID
  dept_name: string;     // 部门名称
  role_id: number;       // 角色ID
  status: number;        // 状态 (1:启用 0:禁用)
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
}
```

### 2.6 会话用户信息 (SessionUser)

```typescript
interface SessionUser {
  id: number;            // 用户ID
  username: string;      // 用户名
  nickname: string;      // 昵称
  avatar: string;        // 头像URL
  dept_id: number;       // 部门ID
  role_id: number;       // 角色ID
}
```

## 3. 应用管理模块数据结构

### 3.1 应用查询参数 (AppQuery)

```typescript
interface AppQuery {
  name?: string;         // 应用名称
  status?: string;       // 应用状态
  group_id?: number;     // 分组ID
  page?: number;         // 页码
  size?: number;         // 每页大小
}
```

### 3.2 应用视图对象 (AppVO)

```typescript
interface AppVO {
  id: number;            // 应用ID
  name: string;          // 应用名称
  description: string;   // 应用描述
  creator: number;       // 创建者ID
  status: string;        // 应用状态 (active, inactive, deleted)
  group_ids: number[];   // 所属分组ID列表
  env_count: number;     // 环境数量
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
}
```

### 3.3 应用实体 (Application)

```typescript
interface Application {
  id: number;            // 应用ID
  name: string;          // 应用名称
  description: string;   // 应用描述
  creator: number;       // 创建者ID
  status: string;        // 应用状态
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
  deleted_at?: string;   // 删除时间
}
```

### 3.4 应用创建请求 (CreateAppRequest)

```typescript
interface CreateAppRequest {
  name: string;          // 应用名称
  description: string;   // 应用描述
  creator: number;       // 创建者ID
}
```

### 3.5 应用更新请求 (UpdateAppRequest)

```typescript
interface UpdateAppRequest {
  name?: string;         // 应用名称
  description?: string;  // 应用描述
}
```

### 3.6 应用分组 (AppGroup)

```typescript
interface AppGroup {
  id: number;            // 分组ID
  name: string;          // 分组名称
  description: string;   // 分组描述
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
}
```

### 3.7 应用分组关联 (AppGroupRelation)

```typescript
interface AppGroupRelation {
  id: number;            // 关联ID
  app_id: number;        // 应用ID
  group_id: number;      // 分组ID
  created_at: string;    // 创建时间
}
```

### 3.8 应用环境 (AppEnv)

```typescript
interface AppEnv {
  id: number;            // 环境ID
  name: string;          // 环境名称
  cluster_id: number;    // 集群ID
  namespace: string;     // 命名空间
  description: string;   // 环境描述
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
}
```

### 3.9 HPA配置 (HPAConfig)

```typescript
interface HPAConfig {
  id: number;                      // HPA配置ID
  app_id: number;                  // 应用ID
  min_replicas: number;            // 最小副本数
  max_replicas: number;            // 最大副本数
  target_cpu_utilization: number; // 目标CPU使用率
  target_memory_utilization: number; // 目标内存使用率
  created_at: string;              // 创建时间
  updated_at: string;              // 更新时间
}
```

### 3.10 HPA配置请求 (HPAConfigRequest)

```typescript
interface HPAConfigRequest {
  min_replicas: number;            // 最小副本数
  max_replicas: number;            // 最大副本数
  target_cpu_utilization: number; // 目标CPU使用率
  target_memory_utilization: number; // 目标内存使用率
}
```

## 4. 权限管理模块数据结构

### 4.1 角色查询参数 (RoleQuery)

```typescript
interface RoleQuery {
  name?: string;         // 角色名称
  code?: string;         // 角色编码
  status?: number;       // 状态
  page?: number;         // 页码
  size?: number;         // 每页大小
}
```

### 4.2 角色视图对象 (RoleVO)

```typescript
interface RoleVO {
  id: number;            // 角色ID
  name: string;          // 角色名称
  code: string;          // 角色编码
  description: string;   // 角色描述
  status: number;        // 状态 (1:启用 0:禁用)
  sort_order: number;    // 排序
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
}
```

### 4.3 角色实体 (Role)

```typescript
interface Role {
  id: number;            // 角色ID
  name: string;          // 角色名称
  code: string;          // 角色编码
  description: string;   // 角色描述
  status: number;        // 状态
  sort_order: number;    // 排序
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
  deleted_at?: string;   // 删除时间
}
```

### 4.4 角色创建请求 (CreateRoleRequest)

```typescript
interface CreateRoleRequest {
  name: string;          // 角色名称
  code: string;          // 角色编码
  description: string;   // 角色描述
  status: number;        // 状态
  sort_order: number;    // 排序
}
```

### 4.5 角色更新请求 (UpdateRoleRequest)

```typescript
interface UpdateRoleRequest {
  name?: string;         // 角色名称
  description?: string;  // 角色描述
  status?: number;       // 状态
  sort_order?: number;   // 排序
}
```

### 4.6 权限查询参数 (PermissionQuery)

```typescript
interface PermissionQuery {
  name?: string;         // 权限名称
  type?: string;         // 权限类型
  status?: number;       // 状态
  parent_id?: number;    // 父权限ID
  page?: number;         // 页码
  size?: number;         // 每页大小
}
```

### 4.7 权限视图对象 (PermissionVO)

```typescript
interface PermissionVO {
  id: number;            // 权限ID
  parent_id: number;     // 父权限ID
  name: string;          // 权限名称
  type: string;          // 权限类型 (menu, api, button)
  path: string;          // 路径
  method: string;        // HTTP方法
  icon: string;          // 图标
  component: string;     // 组件路径
  permission: string;    // 权限标识
  status: number;        // 状态 (1:启用 0:禁用)
  hidden: boolean;       // 是否隐藏
  sort_order: number;    // 排序
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
  children?: PermissionVO[]; // 子权限列表
}
```

### 4.8 权限实体 (Permission)

```typescript
interface Permission {
  id: number;            // 权限ID
  parent_id: number;     // 父权限ID
  name: string;          // 权限名称
  type: string;          // 权限类型
  path: string;          // 路径
  method: string;        // HTTP方法
  icon: string;          // 图标
  component: string;     // 组件路径
  permission: string;    // 权限标识
  status: number;        // 状态
  hidden: boolean;       // 是否隐藏
  sort_order: number;    // 排序
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
  deleted_at?: string;   // 删除时间
}
```

### 4.9 权限创建请求 (CreatePermissionRequest)

```typescript
interface CreatePermissionRequest {
  parent_id: number;     // 父权限ID
  name: string;          // 权限名称
  type: string;          // 权限类型
  path: string;          // 路径
  method: string;        // HTTP方法
  icon: string;          // 图标
  component: string;     // 组件路径
  permission: string;    // 权限标识
  status: number;        // 状态
  hidden: boolean;       // 是否隐藏
  sort_order: number;    // 排序
}
```

### 4.10 权限更新请求 (UpdatePermissionRequest)

```typescript
interface UpdatePermissionRequest {
  name?: string;         // 权限名称
  path?: string;         // 路径
  icon?: string;         // 图标
  status?: number;       // 状态
  sort_order?: number;   // 排序
}
```

### 4.11 用户角色分配请求 (AssignRolesRequest)

```typescript
interface AssignRolesRequest {
  role_ids: number[];    // 角色ID列表
}
```

### 4.12 角色权限分配请求 (AssignPermissionsRequest)

```typescript
interface AssignPermissionsRequest {
  permission_ids: number[]; // 权限ID列表
}
```

### 4.13 权限检查响应 (PermissionCheckResponse)

```typescript
interface PermissionCheckResponse {
  has_permission: boolean; // 是否有权限
}
```

### 4.14 菜单项 (MenuItem)

```typescript
interface MenuItem {
  id: number;            // 菜单ID
  parent_id: number;     // 父菜单ID
  name: string;          // 菜单名称
  type: string;          // 菜单类型
  path: string;          // 路径
  icon: string;          // 图标
  component: string;     // 组件路径
  permission: string;    // 权限标识
  status: number;        // 状态
  hidden: boolean;       // 是否隐藏
  sort_order: number;    // 排序
  children?: MenuItem[]; // 子菜单列表
}
```

## 5. 组织管理模块数据结构

### 5.1 部门视图对象 (DepartmentVO)

```typescript
interface DepartmentVO {
  id: number;            // 部门ID
  parent_id: number;     // 父部门ID
  name: string;          // 部门名称
  code: string;          // 部门编码
  description: string;   // 部门描述
  status: number;        // 状态 (1:启用 0:禁用)
  sort_order: number;    // 排序
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
  children?: DepartmentVO[]; // 子部门列表
  users?: UserVO[];      // 部门用户列表
}
```

### 5.2 部门实体 (Department)

```typescript
interface Department {
  id: number;            // 部门ID
  parent_id: number;     // 父部门ID
  name: string;          // 部门名称
  code: string;          // 部门编码
  description: string;   // 部门描述
  status: number;        // 状态
  sort_order: number;    // 排序
  created_at: string;    // 创建时间
  updated_at: string;    // 更新时间
  deleted_at?: string;   // 删除时间
}
```

### 5.3 部门创建请求 (CreateDepartmentRequest)

```typescript
interface CreateDepartmentRequest {
  parent_id: number;     // 父部门ID
  name: string;          // 部门名称
  code: string;          // 部门编码
  description: string;   // 部门描述
  status: number;        // 状态
  sort_order: number;    // 排序
}
```

### 5.4 部门更新请求 (UpdateDepartmentRequest)

```typescript
interface UpdateDepartmentRequest {
  name?: string;         // 部门名称
  description?: string;  // 部门描述
  status?: number;       // 状态
  sort_order?: number;   // 排序
}
```

### 5.5 用户视图对象 (UserVO)

```typescript
interface UserVO {
  id: number;            // 用户ID
  username: string;      // 用户名
  real_name: string;     // 真实姓名
  email: string;         // 邮箱
  mobile: string;        // 手机号
  status: number;        // 状态 (1:启用 0:禁用)
  is_leader: boolean;    // 是否部门负责人
  created_at: string;    // 创建时间
}
```

### 5.6 部门用户查询参数 (DepartmentUserQuery)

```typescript
interface DepartmentUserQuery {
  pageNum?: number;      // 页码
  pageSize?: number;     // 每页数量
  username?: string;     // 用户名
  realName?: string;     // 真实姓名
}
```

## 6. 常用枚举定义

### 6.1 应用状态 (AppStatus)

```typescript
enum AppStatus {
  ACTIVE = 'active',     // 激活
  INACTIVE = 'inactive', // 未激活
  DELETED = 'deleted'    // 已删除
}
```

### 6.2 权限类型 (PermissionType)

```typescript
enum PermissionType {
  MENU = 'menu',         // 菜单
  API = 'api',           // API接口
  BUTTON = 'button'      // 按钮
}
```

### 6.3 用户状态 (UserStatus)

```typescript
enum UserStatus {
  DISABLED = 0,          // 禁用
  ENABLED = 1            // 启用
}
```

### 6.4 HTTP状态码 (HttpStatus)

```typescript
enum HttpStatus {
  OK = 200,              // 成功
  CREATED = 201,         // 创建成功
  BAD_REQUEST = 400,     // 请求错误
  UNAUTHORIZED = 401,    // 未认证
  FORBIDDEN = 403,       // 权限不足
  NOT_FOUND = 404,       // 资源不存在
  INTERNAL_ERROR = 500   // 服务器错误
}
```

## 7. 分页相关结构

### 7.1 分页查询参数 (PageQuery)

```typescript
interface PageQuery {
  page?: number;         // 页码，从1开始
  size?: number;         // 每页大小，默认10
}
```

### 7.2 分页结果 (PageResult)

```typescript
interface PageResult<T> {
  list: T[];             // 数据列表
  total: number;         // 总记录数
  page: number;          // 当前页码
  size: number;          // 每页大小
}
```

### 7.3 扩展分页结果 (PageResultExt)

```typescript
interface PageResultExt<T> extends PageResult<T> {
  total_pages: number;   // 总页数
  has_next: boolean;     // 是否有下一页
  has_prev: boolean;     // 是否有上一页
}
```

## 8. 时间格式说明

所有时间字段均采用 ISO 8601 格式：

```typescript
type Timestamp = string; // 格式: YYYY-MM-DDTHH:mm:ssZ

// 示例
const timestamp: Timestamp = "2024-01-01T12:00:00Z";
```

## 9. ID类型定义

```typescript
type ID = number;        // 所有ID字段均为数字类型
type UUID = string;      // UUID字符串类型
```

## 10. 可选字段说明

在TypeScript接口定义中：
- `?` 表示可选字段，可以不传递
- 没有 `?` 的字段为必填字段
- `undefined` 或 `null` 值的处理需要根据具体业务逻辑

## 11. 数组类型说明

```typescript
// 数组类型定义
type StringArray = string[];     // 字符串数组
type NumberArray = number[];     // 数字数组
type ObjectArray<T> = T[];       // 对象数组

// 示例
interface Example {
  tags: string[];                // 标签数组
  ids: number[];                 // ID数组
  items: SomeObject[];           // 对象数组
}
```

## 12. 联合类型定义

```typescript
// 状态联合类型
type Status = 'active' | 'inactive' | 'deleted';
type UserRole = 'admin' | 'user' | 'guest';
type PermissionAction = 'create' | 'read' | 'update' | 'delete';
```

## 13. 泛型使用说明

```typescript
// 通用API响应泛型
interface ApiResponse<T = any> {
  code: number;
  data: T;
  message: string;
}

// 使用示例
type UserResponse = ApiResponse<UserInfo>;
type AppListResponse = ApiResponse<PageResult<AppVO>>;
```

## 14. 前端使用建议

### 14.1 类型定义文件组织

建议在前端项目中按模块组织类型定义：

```
src/types/
├── common.ts          // 通用类型
├── auth.ts            // 认证模块类型
├── application.ts     // 应用管理类型
├── authorization.ts   // 权限管理类型
├── organization.ts    // 组织管理类型
└── index.ts          // 类型导出
```

### 14.2 类型守卫使用

```typescript
// 类型守卫函数
function isUserInfo(obj: any): obj is UserInfo {
  return obj && typeof obj.id === 'number' && typeof obj.username === 'string';
}

// 使用示例
if (isUserInfo(response.data)) {
  // 此时 response.data 被确认为 UserInfo 类型
  console.log(response.data.username);
}
```

### 14.3 默认值处理

```typescript
// 为可选字段提供默认值
const defaultAppQuery: Required<AppQuery> = {
  name: '',
  status: '',
  group_id: 0,
  page: 1,
  size: 10
};

// 合并查询参数
function buildAppQuery(query: AppQuery): Required<AppQuery> {
  return { ...defaultAppQuery, ...query };
}
```

---

**文档版本**: v1.0  
**更新时间**: 2024-01-01  
**维护人员**: DevOps Platform Team